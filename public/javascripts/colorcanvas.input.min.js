(function(){var a,b,c,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}},i={}.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},k=[].slice;a=jQuery,g=ColorCanvas.Spine,b=ColorCanvas.Color,d=ColorCanvas.Picker,a.colorcanvas={},a.colorcanvas.replaceInputs=function(){return a("input[type=color]").each(function(){return(new c).replace(this)})},a(function(){return a.colorcanvas.replaceInputs()}),f=function(b){function c(){this.drop=h(this.drop,this),this.drag=h(this.drag,this),this.listen=h(this.listen,this),this.close=h(this.close,this),this.open=h(this.open,this),c.__super__.constructor.apply(this,arguments),this.delegateEvents(this.popupEvents),this.el.delegate("click",".close",this.close),this.el.addClass("popup"),this.el.css({position:"absolute"})}return j(c,b),c.name="Popup",c.prototype.width=400,c.prototype.popupEvents={mousedown:"listen"},c.prototype.open=function(b){var c,d;return b==null&&(b={left:0,top:0}),c=b.left||b.clientX,d=b.top||b.clientY,c+=25,d-=5,this.el.css({left:c,top:d}),a("body").append(this.el),a("body").mousedown(this.close)},c.prototype.close=function(){return a("body").unbind("mousedown",this.close),this.release(),this.trigger("close")},c.prototype.isOpen=function(){return!!this.el.parent().length},c.prototype.listen=function(b){b.stopPropagation();if(b.target!==b.currentTarget)return;return this.dragPosition={left:b.pageX,top:b.pageY},a(document).mousemove(this.drag),a(document).mouseup(this.drop)},c.prototype.drag=function(a){var b,c;return b={left:a.pageX-this.dragPosition.left,top:a.pageY-this.dragPosition.top},this.dragPosition={left:a.pageX,top:a.pageY},c=this.el.offset(),c.left+=b.left,c.top+=b.top,this.el.css(c)},c.prototype.drop=function(b){return a(document).unbind("mousemove",this.drag),a(document).unbind("mouseup",this.drop)},c}(g.Controller),e=function(c){function e(){this.keydown=h(this.keydown,this);var a=this;e.__super__.constructor.apply(this,arguments),this.color||(this.color=new b),this.picker=new d({color:this.color}),this.picker.bind("change",function(){return a.trigger.apply(a,["change"].concat(k.call(arguments)))}),this.append(this.picker)}return j(e,c),e.name="PickerPopup",e.prototype.events={"submit form":"close","click [data-type=cancel]":"close"},e.prototype.open=function(){return a(document).keydown(this.keydown),e.__super__.open.apply(this,arguments)},e.prototype.close=function(){return a(document).unbind("keydown",this.keydown),e.__super__.close.apply(this,arguments)},e.prototype.cancel=function(){return this.trigger("change",this.picker.original),this.close()},e.prototype.keydown=function(a){switch(a.which){case 27:return this.cancel()}},e}(f),c=function(c){function d(){d.__super__.constructor.apply(this,arguments),this.input||(this.input=a("<input />")),this.color||(this.color=new b({r:255,g:0,b:0})),this.render()}return j(d,c),d.name="Input",d.prototype.className="colorCanvasInput",d.prototype.events={click:"open"},d.prototype.render=function(){return this.el.css({background:this.color.toString()})},d.prototype.replace=function(c){return this.input=a(c),this.color.set(new b(this.input.val())),this.input.hide(),this.input.after(this.el),this.input.get(0).type="text"},d.prototype.open=function(){var a=this;if(this.picker&&this.picker.isOpen()){this.picker.close();return}return this.picker=new e({color:this.color}),this.picker.bind("change",function(b){return a.color=b,a.trigger("change",a.color),a.input.val(a.color.toString()),a.input.change(),a.render()}),this.picker.open(this.el.offset())},d}(g.Controller),ColorCanvas.Input=c,ColorCanvas.Popup=f,ColorCanvas.PickerPopup=e}).call(this);